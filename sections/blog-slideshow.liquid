{{ 'blog-slideshow.css' | asset_url | stylesheet_tag }}

{% liquid
    assign padding_top = section.settings.padding_top | append: "px"
    assign padding_bottom = section.settings.padding_bottom | append: "px"

    assign heading = section.settings.heading
    assign btn_label = section.settings.btn_label
    assign btn_url = section.settings.btn_url

    assign blogs = section.settings.blog
%}

<div class="blog-slideshow" style="
        --padding-top: {{ padding_top }};
        --padding-bottom: {{ padding_bottom }};">
    <div class="blog-slideshow__wrapper page-width">
        {% liquid
            assign heading_slideshow = blogs.title | default: heading
        %}

        {% if heading_slideshow != blank %}
            <h2 class="heading-h2">{{ heading_slideshow }}</h2>
        {% endif %}

        {% if section.blocks.size > 0 %}
        <div class="blog-slideshow__content">
            <div class="swiper blog-Slideshow" data-section-id="{{ section.id }}">
                <div class="swiper-wrapper">
                    {% if blogs.articles.size > 0 %}
                        {% for article in blogs.articles %}
                            <div class="swiper-slide">
                                <div class="blog-slideshow__artilcle article-cart-slide">
                                    <a href="{{ article.url }}" class="article-cart-slide__link"><span class="visibility-hidden"></span></a>
                                    <span class="animate-circle-slide"></span>
                                    <div class="article-cart-slide__image">
                                        {% if article.image != blank %}
                                            {{ article.image | image_url: width: 830 | image_tag: preload: true, alt: heading }}
                                        {% else %}
                                            <span class="visibility-hidden"></span>
                                        {% endif %}
                                    </div>
                                    <div class="article-cart-slide__heading">{{ article.title | truncate: 50 }}</div>
                                    <div class="article-cart-slide__published">{{- article.published_at | time_tag: format: 'date' -}}</div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        {% for block in section.blocks %}
                            {% liquid
                                assign article_heading = block.settings.article_heading
                                assign image = block.settings.image
                                assign article_url = block.settings.article_url
                            %}

                            <div class="swiper-slide">
                                <div class="blog-slideshow__artilcle article-cart-slide">
                                    <a href="{{ article_url }}" class="article-cart-slide__link"><span class="visibility-hidden"></span></a>
                                    <span class="animate-circle-slide"></span>
                                    <div class="article-cart-slide__image">
                                        {% if image != blank %}
                                            {{ image | image_url: width: 830 | image_tag: preload: true, alt: heading }}
                                        {% else %}
                                            <span class="visibility-hidden"></span>
                                        {% endif %}
                                    </div>
                                    <div class="article-cart-slide__heading">{{ article_heading }}</div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="blog-slideshow__control">
                    {% if blogs.articles.size > 0 or  section.blocks.size > 0 %}
                        <div class="blog-slideshow__buttons">
                            <div class="swiper-button-prev">
                                <svg xmlns="http://www.w3.org/2000/svg" data-testid="arrow-left-icon" viewBox="0 0 24 24" class="css-vt0chc">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.8839 4.11612C12.3957 3.62796 11.6043 3.62796 11.1161 4.11612L4.11612 11.1161C3.62796 11.6043 3.62796 12.3957 4.11612 12.8839L11.1161 19.8839C11.6043 20.372 12.3957 20.372 12.8839 19.8839C13.372 19.3957 13.372 18.6043 12.8839 18.1161L8.01777 13.25H19C19.6904 13.25 20.25 12.6904 20.25 12C20.25 11.3096 19.6904 10.75 19 10.75H8.01777L12.8839 5.88388C13.372 5.39573 13.372 4.60427 12.8839 4.11612Z" fill="currentColor"></path>
                                </svg>
                            </div>
                            <div class="swiper-button-next">
                                <svg xmlns="http://www.w3.org/2000/svg" data-testid="arrow-right-icon" viewBox="0 0 24 24" class="css-vt0chc">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.1161 4.11612C11.6043 3.62796 12.3957 3.62796 12.8839 4.11612L19.8839 11.1161C20.372 11.6043 20.372 12.3957 19.8839 12.8839L12.8839 19.8839C12.3957 20.372 11.6043 20.372 11.1161 19.8839C10.628 19.3957 10.628 18.6043 11.1161 18.1161L15.9822 13.25H5C4.30964 13.25 3.75 12.6904 3.75 12C3.75 11.3096 4.30964 10.75 5 10.75H15.9822L11.1161 5.88388C10.628 5.39573 10.628 4.60427 11.1161 4.11612Z" fill="currentColor"></path>
                                </svg>
                            </div>
                        </div>
                    {% endif %}

                    {% if btn_label != blank %}
                        <a href="{{ btn_url }}" class="blog-slideshow__see-all">{{ btn_label }}</a>
                    {% endif %}
                </div>

            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
    function initSwiper(swiperContainer) {
        if (!swiperContainer) return;

        const nextBtn = swiperContainer.querySelector('.swiper-button-next');
        const prevBtn = swiperContainer.querySelector('.swiper-button-prev');

        new Swiper(swiperContainer, {
            spaceBetween: 24,
            navigation: {
                nextEl: nextBtn,
                prevEl: prevBtn,
            },
            breakpoints: {
                0: {
                    slidesPerView: 'auto',
                },
                640: {
                    slidesPerView: 2,
                },
                768: {
                    slidesPerView: 3,
                },
                1198: {
                    slidesPerView: 4,
                },
            },
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.blog-Slideshow[data-section-id]').forEach(initSwiper);
    });

    document.addEventListener('shopify:section:load', (event) => {
        const swiperContainer = event.target.querySelector('.blog-Slideshow');
        initSwiper(swiperContainer);
    });
</script>

{% schema %}
{
  "name": "Blog slideshow",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "blog",
      "id": "blog",
      "label": "Blog"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Heading"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "btn_label",
      "label": "Label",
      "default": "See all"
    },
    {
      "type": "url",
      "id": "btn_url",
      "label": "URL"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Top padding",
      "default": 160
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Bottom padding",
      "default": 64
    }
  ],
  "blocks": [
    {
      "type": "article",
      "name": "Article",
      "settings":[
        {
          "type": "text",
          "id": "article_heading",
          "label": "Heading",
          "default": "Heading"
        },
        {
          "type": "url",
          "id": "article_url",
          "label": "URL"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
        ]
      }
    ],
  "presets": [
    {
      "name": "Blog slideshow",
      "blocks": [
        {
          "type": "article"
        },
        {
          "type": "article"
        },
        {
          "type": "article"
        },
        {
          "type": "article"
        },
        {
          "type": "article"
        }
      ]
    }
  ]
}
{% endschema %}